<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz da file testo</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; background: #f7f7f7; border-radius: 8px; }
  h1 { text-align: center; }
  #domanda { font-weight: bold; font-size: 1.3em; margin-bottom: 10px; }
  #paragrafo { font-style: italic; margin-bottom: 15px; }
  button.opzione {
    display: block; width: 100%; padding: 10px; margin: 8px 0; font-size: 1em;
    cursor: pointer; border-radius: 4px; border: 1px solid #333; background: white;
    transition: background-color 0.3s;
  }
  button.opzione:hover { background-color: #ddd; }
  button.opzione.correct { background-color: #4caf50; color: white; }
  button.opzione.wrong { background-color: #f44336; color: white; }
  #nextBtn {
    margin-top: 20px; padding: 10px 20px; font-size: 1.1em; cursor: pointer; disabled: true;
  }
  #score { font-weight: bold; font-size: 1.2em; text-align: center; margin-top: 25px; }
</style>
</head>
<body>

<h1>Quiz da file testo</h1>
<div id="quizBox">
  <div id="domanda"></div>
  <div id="paragrafo"></div>
  <div id="risposte"></div>
  <button id="nextBtn" disabled>Prossima domanda</button>
  <div id="score"></div>
</div>

<script>
const fileTxtURL = "https://drive.google.com/uc?export=download&id=1O1UDz1atUQa4fsQChStBJ7LyPlLOMxas";

// Variabili quiz
let domande = [];
let current = 0;
let score = 0;

// Carica il file di testo e parsalo
fetch(fileTxtURL)
  .then(r => r.text())
  .then(text => {
    domande = parseQuiz(text);
    mostraDomanda();
  })
  .catch(e => alert('Errore nel caricamento del quiz: ' + e));

// Funzione per parsare testo quiz in array domande
function parseQuiz(text) {
  let lines = text.split(/\r?\n/);
  let result = [];
  let block = {};

  for(let i=0; i<lines.length; i++) {
    let line = lines[i].trim();
    if (!line) continue; // salto righe vuote

    // Inizio nuova domanda
    if (/^\d+\./.test(line)) {
      if (Object.keys(block).length) {
        result.push(block);
        block = {};
      }
      block.domanda = line;
      block.opzioni = {};
      continue;
    }

    // Riga paragrafo (dopo domanda, prima delle opzioni)
    if (!block.paragrafo && !/^([A-D])\./.test(line) && !line.startsWith("Answer:")) {
      block.paragrafo = line;
      continue;
    }

    // Opzioni A-D
    let optMatch = line.match(/^([A-D])\.\s*(.*)$/);
    if (optMatch) {
      let lettera = optMatch[1];
      let testo = optMatch[2];
      block.opzioni[lettera] = testo;
      continue;
    }

    // Risposta corretta
    if (line.startsWith("Answer:")) {
      block.risposta = line.split(":")[1].trim();
    }
  }

  // Ultima domanda
  if (Object.keys(block).length) result.push(block);
  return result;
}

// Mostra domanda corrente
function mostraDomanda() {
  let q = domande[current];
  document.getElementById('domanda').textContent = q.domanda || '';
  document.getElementById('paragrafo').textContent = q.paragrafo || '';

  const risposteDiv = document.getElementById('risposte');
  risposteDiv.innerHTML = '';

  for (const [lettera, testo] of Object.entries(q.opzioni)) {
    const btn = document.createElement('button');
    btn.className = 'opzione';
    btn.textContent = lettera + '. ' + testo;
    btn.dataset.lettera = lettera;
    btn.onclick = () => checkRisposta(btn);
    risposteDiv.appendChild(btn);
  }

  document.getElementById('nextBtn').disabled = true;
  document.getElementById('score').textContent = '';
}

// Controlla risposta cliccata
function checkRisposta(button) {
  const lettera = button.dataset.lettera;
  const q = domande[current];
  const correct = q.risposta;

  // Blocca tutti i bottoni
  const btns = document.querySelectorAll('button.opzione');
  btns.forEach(b => {
    b.disabled = true;
    if (b.dataset.lettera === correct) {
      b.classList.add('correct');
    }
    if (b === button && lettera !== correct) {
      b.classList.add('wrong');
    }
  });

  if (lettera === correct) {
    score++;
  }

  document.getElementById('nextBtn').disabled = false;
}

// Avanti domanda
document.getElementById('nextBtn').onclick = () => {
  current++;
  if (current < domande.length) {
    mostraDomanda();
  } else {
    document.getElementById('quizBox').innerHTML = `<h2>Quiz completato!</h2><p>Hai risposto correttamente a ${score} su ${domande.length} domande.</p>`;
  }
};
</script>

</body>
</html>
