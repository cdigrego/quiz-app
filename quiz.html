<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz Viewer</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    font-size: 24px;
    background: #f9f9f9;
    max-width: 700px;
    margin: auto;
  }
  #domanda {
    font-weight: bold;
    margin-bottom: 10px;
  }
  #paragrafo {
    font-style: italic;
    margin-bottom: 20px;
    color: #555;
  }
  .opzione {
    margin: 8px 0;
  }
  button {
    padding: 10px 20px;
    font-size: 20px;
    margin: 15px 10px 0 0;
  }
</style>
</head>
<body>

<div id="quizContainer">
  <div id="domanda">Caricamento domanda...</div>
  <div id="paragrafo"></div>
  <div id="opzioni"></div>
  <div>
    <button onclick="indietro()">« Indietro</button>
    <button onclick="avanti()">Avanti »</button>
  </div>
</div>

<script>
const quizTxtURL = "https://drive.google.com/uc?export=download&id=1O1UDz1atUQa4fsQChStBJ7LyPlLOMxas";

let domande = [];
let currentIndex = 0;

fetch(quizTxtURL)
  .then(response => response.text())
  .then(text => {
    domande = parseQuiz(text);
    showQuestion(currentIndex);
  })
  .catch(err => {
    document.getElementById('domanda').textContent = "Errore nel caricamento quiz.";
    console.error(err);
  });

function parseQuiz(text) {
  let righe = text.split(/\r?\n/).map(r => r.trim()).filter(r => r.length > 0);
  let blocchi = [];
  let buffer = [];
  
  for (let r of righe) {
    if (/^\d+\./.test(r) && buffer.length > 0) {
      blocchi.push(buffer);
      buffer = [r];
    } else {
      buffer.push(r);
    }
  }
  if (buffer.length > 0) blocchi.push(buffer);

  return blocchi.map(b => {
    return {
      domanda: b[0].replace(/^\d+\.\s*/, ""),
      paragrafo: b[1] || "",
      opzioni: {
        A: b[3] || "",
        B: b[4] || "",
        C: b[5] || "",
        D: b[6] || ""
      },
      answer: (b.find(r => r.startsWith("Answer:")) || "").split(":")[1]?.trim() || ""
    };
  });
}

function showQuestion(i) {
  if (i < 0 || i >= domande.length) return;
  const q = domande[i];
  document.getElementById('domanda').textContent = q.domanda;
  document.getElementById('paragrafo').textContent = q.paragrafo;

  let opzioniDiv = document.getElementById('opzioni');
  opzioniDiv.innerHTML = "";

  for (const [lettera, testo] of Object.entries(q.opzioni)) {
    let btn = document.createElement('button');
    btn.textContent = lettera + ". " + testo;
    btn.onclick = () => checkAnswer(lettera);
    btn.className = 'opzione';
    opzioniDiv.appendChild(btn);
  }
}

function checkAnswer(scelta) {
  const q = domande[currentIndex];
  if (scelta === q.answer) {
    alert("✅ Corretto!");
  } else {
    alert("❌ Sbagliato! La risposta giusta è: " + q.answer);
  }
}

function avanti() {
  if (currentIndex < domande.length - 1) {
    currentIndex++;
    showQuestion(currentIndex);
  }
}

function indietro() {
  if (currentIndex > 0) {
    currentIndex--;
    showQuestion(currentIndex);
  }
}
</script>

</body>
</html>
