<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz Viewer</title>
<style>
  body{
    font-family:Arial,Helvetica,sans-serif;
    padding:20px;
    font-size:22px;
    background:#f9f9f9;
    max-width:700px;
    margin:auto;
  }
  #domanda{font-weight:bold;margin-bottom:10px}
  #paragrafo{font-style:italic;margin-bottom:20px;color:#555}
  button{
    display:block;
    width:100%;
    text-align:left;
    padding:10px 14px;
    margin:8px 0;
    font-size:20px;
    border:1px solid #333;
    border-radius:6px;
    background:#fff;
    cursor:pointer;
  }
  button:hover{background:#eaeaea}
  #nav{margin-top:25px;text-align:center}
  #nav button{width:auto;margin:0 10px}
</style>
</head>
<body>

<div id="quizContainer">
  <div id="domanda">Caricamento domanda…</div>
  <div id="paragrafo"></div>
  <div id="opzioni"></div>

  <div id="nav">
    <button onclick="indietro()">« Indietro</button>
    <button onclick="avanti()">Avanti »</button>
  </div>
</div>

<script>
const quizTxtURL = "https://cdigrego.github.io/quiz-app/quiz.txt";

let domande = [];
let currentIndex = 0;

fetch(quizTxtURL)
  .then(r => {
    if (!r.ok) throw new Error("Impossibile scaricare quiz.txt");
    return r.text();
  })
  .then(txt => {
    domande = parseQuiz(txt);
    showQuestion(0);
  })
  .catch(err => {
    document.getElementById("domanda").textContent = "Errore: " + err.message;
  });

function parseQuiz(text){
  const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length);
  const blocks = [];
  let buf = [];

  for (const l of lines){
    if (/^\d+\./.test(l) && buf.length){
      blocks.push(buf);
      buf = [l];
    }else{
      buf.push(l);
    }
  }
  if (buf.length) blocks.push(buf);

  return blocks.map(b => {
    const q = { domanda:"", paragrafo:"", opzioni:{}, answer:"" };
    q.domanda = b[0].replace(/^\d+\.\s*/, "");
    q.paragrafo = b[1] || "";
    for (let i=2;i<b.length;i++){
      if (/^[A-D]\./.test(b[i]) && i+1 < b.length){
        const lett = b[i][0];          // 'A'..'D'
        q.opzioni[lett] = b[i+1];      // testo riga successiva
        i++;                           // salta testo già preso
      }else if (b[i].startsWith("Answer:")){
        q.answer = b[i].split(":")[1].trim();
      }
    }
    return q;
  });
}

function showQuestion(i){
  if (i<0 || i>=domande.length) return;
  const q = domande[i];
  currentIndex = i;
  document.getElementById("domanda").textContent = q.domanda;
  document.getElementById("paragrafo").textContent = q.paragrafo;
  const opDiv = document.getElementById("opzioni");
  opDiv.innerHTML = "";

  Object.entries(q.opzioni).forEach(([lett,text])=>{
    const btn = document.createElement("button");
    btn.textContent = `${lett}. ${text}`;
    btn.onclick = () => checkAnswer(lett,btn);
    opDiv.appendChild(btn);
  });
}

function checkAnswer(lett,btn){
  const correct = domande[currentIndex].answer;
  if (lett === correct){
    btn.style.background="#b7e4b0";
    alert("✅ Corretto!");
  }else{
    btn.style.background="#f5b3af";
    alert("❌ Sbagliato! La risposta giusta è: " + correct);
  }
}

function avanti(){
  if (currentIndex < domande.length-1) showQuestion(currentIndex+1);
}
function indietro(){
  if (currentIndex > 0) showQuestion(currentIndex-1);
}
</script>
</body>
</html>
